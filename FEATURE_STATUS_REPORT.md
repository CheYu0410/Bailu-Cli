# ğŸ“Š Bailu CLI åŠŸèƒ½çŠ¶æ€æŠ¥å‘Š

ç”Ÿæˆæ—¶é—´ï¼š2025-11-24

## âœ… å·²å®ç°çš„åŠŸèƒ½

### 1. **æµå¼è¾“å‡º** âœ…
**çŠ¶æ€ï¼š** å·²å®Œæ•´å®ç°  
**æ–‡ä»¶ï¼š** `src/llm/client.ts`, `src/agent/orchestrator.ts`

```typescript
// LLMClient.chatStream() - æµå¼ API
async *chatStream(messages: ChatMessage[], tools?: any[]): AsyncGenerator<string>

// Orchestrator ä¸­å®æ—¶æ˜¾ç¤º
for await (const chunk of this.llmClient.chatStream(messages, tools)) {
  process.stdout.write(chunk);  // é€å­—æ˜¾ç¤º
}
```

**ä½¿ç”¨åœºæ™¯ï¼š**
- âœ… `bailu ask` - æµå¼æ˜¾ç¤º
- âœ… `bailu chat` - æµå¼æ˜¾ç¤ºï¼ˆå¸¦å®æ—¶è§£æï¼‰
- âœ… `/commit` - æµå¼ç”Ÿæˆæäº¤ä¿¡æ¯

---

### 2. **æŒä¹…å†å²è®°å½•** âœ…
**çŠ¶æ€ï¼š** å·²å®ç°  
**æ–‡ä»¶ï¼š** `src/utils/history.ts`

**åŠŸèƒ½ï¼š**
- âœ… è·¨ä¼šè¯ä¿å­˜åˆ° `~/.bailu-cli/history`
- âœ… è‡ªåŠ¨åŠ è½½å†å²
- âœ… å»é‡ï¼ˆé¿å…è¿ç»­é‡å¤ï¼‰
- âœ… é™åˆ¶å¤§å°ï¼ˆæœ€å¤š 1000 æ¡ï¼‰
- âœ… æœç´¢åŠŸèƒ½ `search(query)`

```typescript
export class HistoryManager {
  add(command: string): void
  getAll(): string[]
  search(query: string): string[]
  clear(): void
}
```

**æ”¹è¿›ç©ºé—´ï¼š**
- âš ï¸ ç¼ºå°‘ Ctrl+R äº¤äº’å¼æœç´¢
- âš ï¸ ç¼ºå°‘å†å²æµè§ˆå¿«æ·é”®ï¼ˆä¸Šä¸‹ç®­å¤´å·²æœ‰ï¼Œä½†åŠŸèƒ½æœ‰é™ï¼‰

---

### 3. **ä¼šè¯ç®¡ç†** âœ…ï¼ˆéƒ¨åˆ†ï¼‰
**çŠ¶æ€ï¼š** å·²å®ç°åŸºç¡€åŠŸèƒ½  
**æ–‡ä»¶ï¼š** `src/agent/session.ts`, `src/cli.ts`

**å·²æœ‰åŠŸèƒ½ï¼š**
```typescript
// bailu run å‘½ä»¤
bailu run "ä»»åŠ¡æè¿°"              # åˆ›å»ºæ–°ä»»åŠ¡
bailu run --resume <sessionId>   # æ¢å¤ä¼šè¯
bailu run --list                 # åˆ—å‡ºæ‰€æœ‰ä¼šè¯
```

**æ”¹è¿›ç©ºé—´ï¼š**
- âš ï¸ æ²¡æœ‰ `/save` `/load` æ–œçº¿å‘½ä»¤
- âš ï¸ Chat æ¨¡å¼ä¸æ”¯æŒä¼šè¯ä¿å­˜
- âš ï¸ ç¼ºå°‘ä¼šè¯åˆ«åï¼ˆåªèƒ½ç”¨ IDï¼‰

---

### 4. **é¡¹ç›®çº§é…ç½®** âœ…
**çŠ¶æ€ï¼š** å·²å®ç°  
**æ–‡ä»¶ï¼š** `src/config.ts`

**æ”¯æŒçš„é…ç½®æ–‡ä»¶ï¼š**
- âœ… `.bailu.config.json`
- âœ… `.bailurc.json`
- âœ… `.bailurc`

**é…ç½®ä¼˜å…ˆçº§ï¼š**
```
CLI å‚æ•° > é¡¹ç›®é…ç½® > ç”¨æˆ·é…ç½® > ç¯å¢ƒå˜é‡ > é»˜è®¤å€¼
```

---

### 5. **æ–‡ä»¶ç®¡ç†** âœ…
**çŠ¶æ€ï¼š** åˆšå®ç°ï¼ˆPriority 2ï¼‰  
**æ–‡ä»¶ï¼š** `src/agent/chat.ts`, `src/agent/slash-commands.ts`

**å‘½ä»¤ï¼š**
- âœ… `/add <æ–‡ä»¶è·¯å¾„>` - æ·»åŠ æ–‡ä»¶åˆ°ä¸Šä¸‹æ–‡
- âœ… `/drop <æ–‡ä»¶è·¯å¾„>` - ç§»é™¤æ–‡ä»¶
- âœ… `/drop all` - æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶
- âœ… `/files` - åˆ—å‡ºå½“å‰æ–‡ä»¶

---

### 6. **å¤šè¡Œè¾“å…¥** âœ…
**çŠ¶æ€ï¼š** å·²å®ç°ï¼ˆPriority 3ï¼‰  
**æ–¹å¼ï¼š** Shell æ ‡å‡†ç»­è¡Œç¬¦ `\`

**ç”¨æ³•ï¼š**
```bash
ä½ : ç¬¬ä¸€è¡Œ\
... ç¬¬äºŒè¡Œ\
... ç¬¬ä¸‰è¡Œ
[æäº¤]
```

---

### 7. **å¤‡ä»½ä¸æ¢å¤** âœ…
**çŠ¶æ€ï¼š** å·²å®ç°  
**æ–‡ä»¶ï¼š** `src/utils/backup.ts`

**åŠŸèƒ½ï¼š**
- âœ… è‡ªåŠ¨å¤‡ä»½ä¿®æ”¹å‰çš„æ–‡ä»¶
- âœ… `/undo` å‘½ä»¤å›æ»š
- âœ… ä¿å­˜åˆ° `.bailu/backups/`

---

### 8. **åŒ Ctrl+C é€€å‡º** âœ…
**çŠ¶æ€ï¼š** å·²å®ç°  
**æ–‡ä»¶ï¼š** `src/agent/chat.ts`

```typescript
// ç¬¬ä¸€æ¬¡ Ctrl+C - æç¤º
// ç¬¬äºŒæ¬¡ Ctrl+Cï¼ˆ3ç§’å†…ï¼‰- é€€å‡º
```

---

### 9. **Git é›†æˆ** âœ…ï¼ˆéƒ¨åˆ†ï¼‰
**çŠ¶æ€ï¼š** éƒ¨åˆ†å®ç°  
**æ–‡ä»¶ï¼š** `src/git/auto-commit.ts`

**å·²æœ‰åŠŸèƒ½ï¼š**
- âœ… `/commit` - AI ç”Ÿæˆæäº¤ä¿¡æ¯
- âœ… è‡ªåŠ¨ git add
- âœ… è‡ªåŠ¨ git commit

**ç¼ºå°‘åŠŸèƒ½ï¼š**
- âŒ Git æ ¹ç›®å½•æ£€æµ‹ï¼ˆç›®å‰ç”¨ `process.cwd()`ï¼‰
- âŒ è‡ªåŠ¨æäº¤æ¨¡å¼

---

### 10. **æ–œçº¿å‘½ä»¤ç³»ç»Ÿ** âœ…
**çŠ¶æ€ï¼š** å®Œæ•´å®ç°  
**æ–‡ä»¶ï¼š** `src/agent/slash-commands.ts`, `src/agent/autocomplete.ts`

**å·²å®ç°å‘½ä»¤ï¼š**
- âœ… `/help`, `/h` - å¸®åŠ©
- âœ… `/status`, `/s` - çŠ¶æ€
- âœ… `/tokens`, `/t` - Token ç»Ÿè®¡
- âœ… `/model`, `/m` - åˆ‡æ¢æ¨¡å‹
- âœ… `/models` - åˆ—å‡ºæ¨¡å‹
- âœ… `/history` - å†å²æ‘˜è¦
- âœ… `/compress` - å‹ç¼©ä¸Šä¸‹æ–‡
- âœ… `/settings` - é…ç½®ç®¡ç†
- âœ… `/mode` - åˆ‡æ¢å®‰å…¨æ¨¡å¼
- âœ… `/undo`, `/u` - å›æ»šä¿®æ”¹
- âœ… `/commit` - Git æäº¤
- âœ… `/workspace` - å·¥ä½œåŒºä¿¡æ¯
- âœ… `/add`, `/drop`, `/files` - æ–‡ä»¶ç®¡ç†
- âœ… `/clear`, `/c` - æ¸…ç©ºå†å²
- âœ… `/exit`, `/q` - é€€å‡º

---

## âŒ æœªå®ç°çš„åŠŸèƒ½

### 1. **Git æ ¹ç›®å½•æ£€æµ‹** âŒ
**çŠ¶æ€ï¼š** æœªå®ç°  
**å½“å‰ï¼š** ä½¿ç”¨ `process.cwd()`

**å»ºè®®å®ç°ï¼š**
```typescript
// src/utils/git.ts
export function findGitRoot(startDir: string = process.cwd()): string | null {
  let current = startDir;
  while (current !== path.parse(current).root) {
    if (fs.existsSync(path.join(current, '.git'))) {
      return current;
    }
    current = path.dirname(current);
  }
  return null;
}
```

---

### 2. **æ–‡ä»¶è‡ªåŠ¨è¡¥å…¨** âŒ
**çŠ¶æ€ï¼š** æœªå®ç°  
**å»ºè®®ï¼š** Tab è¡¥å…¨æ–‡ä»¶è·¯å¾„

---

### 3. **Diff é¢„è§ˆ** âŒ
**çŠ¶æ€ï¼š** æœªå®ç°  
**åŠŸèƒ½ï¼š** ä¿®æ”¹å‰æ˜¾ç¤ºå˜æ›´é¢„è§ˆ

---

### 4. **API é‡è¯•æœºåˆ¶** âŒ
**çŠ¶æ€ï¼š** æœªå®ç°  
**å½“å‰ï¼š** API å¤±è´¥ç›´æ¥æŠ›å‡ºé”™è¯¯

---

### 5. **Chat ä¼šè¯ä¿å­˜/åŠ è½½** âŒ
**çŠ¶æ€ï¼š** æœªå®ç°  
**å»ºè®®å‘½ä»¤ï¼š**
- `/save <name>` - ä¿å­˜å½“å‰ä¼šè¯
- `/load <name>` - åŠ è½½ä¼šè¯
- `/sessions` - åˆ—å‡ºæ‰€æœ‰ä¼šè¯

---

### 6. **äº¤äº’å¼å†å²æœç´¢** âŒ
**çŠ¶æ€ï¼š** æœªå®ç°  
**å»ºè®®ï¼š** Ctrl+R æœç´¢å†å²

---

### 7. **æ¨¡æ¿ç³»ç»Ÿ** âŒ
**çŠ¶æ€ï¼š** æœªå®ç°

---

### 8. **æµ‹è¯•è‡ªåŠ¨è¿è¡Œ** âŒ
**çŠ¶æ€ï¼š** æœªå®ç°

---

### 9. **æ‰¹é‡æ–‡ä»¶æ“ä½œ** âŒ
**çŠ¶æ€ï¼š** æœªå®ç°  
**å»ºè®®ï¼š**
```bash
/add src/**/*.ts         # Glob æ¨¡å¼
/add @git-changed        # Git ä¿®æ”¹çš„æ–‡ä»¶
/add @recent-10          # æœ€è¿‘ä¿®æ”¹çš„ 10 ä¸ªæ–‡ä»¶
```

---

### 10. **æ€§èƒ½ç›‘æ§** âŒ
**çŠ¶æ€ï¼š** æœªå®ç°  
**å»ºè®®ï¼š**
```bash
/stats

ğŸ“Š ä¼šè¯ç»Ÿè®¡ï¼š
  â€¢ Token ä½¿ç”¨: 1,234 / 50,000
  â€¢ å·¥å…·è°ƒç”¨: 5 æ¬¡
  â€¢ å“åº”æ—¶é—´: å¹³å‡ 2.3s
  â€¢ æˆæœ¬ä¼°ç®—: $0.02
```

---

## ğŸ¯ å»ºè®®ä¼˜å…ˆå®ç°çš„åŠŸèƒ½ï¼ˆæŒ‰éš¾åº¦æ’åºï¼‰

| # | åŠŸèƒ½ | éš¾åº¦ | ä»·å€¼ | æ–‡ä»¶ | é¢„è®¡æ—¶é—´ |
|---|------|------|------|------|----------|
| 1 | **Git æ ¹ç›®å½•æ£€æµ‹** | â­ ä½ | â­â­â­ é«˜ | æ–°å»º `src/utils/git.ts` | 30åˆ†é’Ÿ |
| 2 | **æ€§èƒ½ç›‘æ§ /stats** | â­ ä½ | â­â­ ä¸­ | `src/agent/slash-commands.ts` | 45åˆ†é’Ÿ |
| 3 | **Chat ä¼šè¯ä¿å­˜** | â­â­ ä¸­ | â­â­â­ é«˜ | `src/agent/chat.ts` | 1å°æ—¶ |
| 4 | **API é‡è¯•æœºåˆ¶** | â­â­ ä¸­ | â­â­â­ é«˜ | `src/llm/client.ts` | 1å°æ—¶ |
| 5 | **Diff é¢„è§ˆ** | â­â­â­ é«˜ | â­â­â­ é«˜ | `src/tools/*-tool.ts` | 2å°æ—¶ |
| 6 | **æ–‡ä»¶è‡ªåŠ¨è¡¥å…¨** | â­â­â­â­ å¾ˆé«˜ | â­â­ ä¸­ | `src/agent/chat.ts` | 3å°æ—¶ |

---

## ğŸ“ æ€»ç»“

### å½“å‰å®Œæˆåº¦

- âœ… **å·²å®ç°æ ¸å¿ƒåŠŸèƒ½ï¼š** 10/20 = 50%
- ğŸŸ¡ **éƒ¨åˆ†å®ç°ï¼š** 2/20 = 10%
- âŒ **æœªå®ç°ï¼š** 8/20 = 40%

### å»ºè®®å®ç°é¡ºåº

**Phase 1ï¼ˆç®€å•å¿«é€Ÿï¼‰ï¼š**
1. Git æ ¹ç›®å½•æ£€æµ‹
2. æ€§èƒ½ç›‘æ§ /stats

**Phase 2ï¼ˆé‡è¦åŠŸèƒ½ï¼‰ï¼š**
3. Chat ä¼šè¯ä¿å­˜/åŠ è½½
4. API é‡è¯•æœºåˆ¶

**Phase 3ï¼ˆæå‡ä½“éªŒï¼‰ï¼š**
5. Diff é¢„è§ˆ
6. æ–‡ä»¶è‡ªåŠ¨è¡¥å…¨

---

**ç”Ÿæˆæ—¶é—´ï¼š** 2025-11-24  
**åˆ†æå·¥å…·ï¼š** Cascade AI
