# Bailu CLI

**ä¸€å€‹ç”± AI é©…å‹•çš„çµ‚ç«¯æ™ºèƒ½é«”ï¼Œè®“ä»£ç¢¼è‡ªå·±æœƒæ”¹ä»£ç¢¼ã€‚**

Bailu CLI æ˜¯å°æ¨™ OpenAI Codex çš„æœ¬åœ°åŒ– Agent å·¥å…·ï¼Œé›†æˆç™½é¹¿å¤§æ¨¡å‹ï¼Œæ”¯æŒå·¥å…·èª¿ç”¨ã€å¤šè¼ªå°è©±ã€è‡ªå‹•ç·¨ç¢¼å’Œæ¸¬è©¦é©—è­‰ã€‚

```
                                        ,--,                                          ,--,             
                                     ,---.'|                                       ,---.'|             
    ,---,.     ,---,           ,---, |   | :                             ,----..   |   | :       ,---, 
  ,'  .'  \   '  .' \       ,`--.' | :   : |             ,--,           /   /   \  :   : |    ,`--.' | 
,---.' .' |  /  ;    '.     |   :  : |   ' :           ,'_ /|          |   :     : |   ' :    |   :  : 
|   |  |: | :  :       \    :   |  ' ;   ; '      .--. |  | :          .   |  ;. / ;   ; '    :   |  ' 
:   :  :  / :  |   /\   \   |   :  | '   | |__  ,'_ /| :  . |          .   ; /--`  '   | |__  |   :  | 
:   |    ;  |  :  ' ;.   :  '   '  ; |   | :.'| |  ' | |  . .          ;   | ;     |   | :.'| '   '  ; 
|   :     \ |  |  ;/  \   \ |   |  | '   :    ; |  | ' |  | |          |   : |     '   :    ; |   |  | 
|   |   . | '  :  | \  \ ,' '   :  ; |   |  ./  :  | | :  ' ;          .   | '___  |   |  ./  '   :  ; 
'   :  '; | |  |  '  '--'   |   |  ' ;   : ;    |  ; ' |  | '          '   ; : .'| ;   : ;    |   |  ' 
|   |  | ;  |  :  :         '   :  | |   ,/     :  | : ;  ; |          '   | '/  : |   ,/     '   :  | 
|   :   /   |  | ,'         ;   |.'  '---'      '  :  `--'   \         |   :    /  '---'      ;   |.'  
|   | ,'    `--''           '---'               :  ,      .-./          \   \ .'              '---'    
`----'                                           `--`----'               `---`                         
```

## âœ¨ ä¸»è¦åŠŸèƒ½

### ğŸ¤– å·¥å…·èª¿ç”¨ç³»çµ±
- **read_file** - è®€å–æ–‡ä»¶å…§å®¹
- **write_file** - å¯«å…¥æ–‡ä»¶ï¼ˆæ”¯æŒ diff é è¦½ï¼‰
- **list_directory** - éè¿´åˆ—å‡ºç›®éŒ„
- **run_command** - å®‰å…¨åŸ·è¡Œ shell å‘½ä»¤
- **apply_diff** - æ‡‰ç”¨ unified diff è£œä¸

### ğŸ›¡ï¸ ä¸‰ç¨®å®‰å…¨æ¨¡å¼
- **dry-run** - åƒ…é¡¯ç¤ºè¨ˆç•«ï¼Œä¸å¯¦éš›åŸ·è¡Œ
- **review** - æ¯å€‹æ“ä½œå‰éœ€è¦ç”¨æˆ¶ç¢ºèªï¼ˆé»˜èªï¼‰
- **auto-apply** - è‡ªå‹•åŸ·è¡Œï¼ˆåƒ…ç”¨æ–¼å¯ä¿¡ç’°å¢ƒï¼‰

### ğŸ’¬ äº¤äº’æ¨¡å¼
- **bailu ask** - å–®æ¬¡å•ç­”ï¼ˆåªè®€ï¼‰
- **bailu fix** - è‡ªå‹•ä¿®æ”¹ä»£ç¢¼ï¼ˆæ”¯æŒå·¥å…·èª¿ç”¨ï¼‰
- **bailu chat** - å¤šè¼ªå°è©±æ¨¡å¼
- **bailu run** - è¤‡é›œä»»å‹™åŸ·è¡Œï¼ˆæ”¯æŒæš«åœ/æ¢å¾©ï¼‰

### ğŸ” æ™ºèƒ½ Diff
- ä½¿ç”¨çœŸæ­£çš„ unified diff ç®—æ³•
- å½©è‰²é«˜äº®é¡¯ç¤ºï¼ˆ+ç¶ è‰²ã€-ç´…è‰²ï¼‰
- è‡ªå‹•çµ±è¨ˆå¢åˆªè¡Œæ•¸

### ğŸ“¦ æœƒè©±ç®¡ç†
- ä»»å‹™è‡ªå‹•ä¿å­˜åˆ° `.bailu/sessions/`
- æ”¯æŒ `--resume` æ¢å¾©ä¸­æ–·çš„ä»»å‹™
- `--list` æŸ¥çœ‹æ‰€æœ‰æ­·å²æœƒè©±

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. å®‰è£ä¾è³´

```bash
npm install
```

### 2. æ§‹å»º

```bash
npm run build
```

### 3. é…ç½® API Key

ç¬¬ä¸€æ¬¡é‹è¡Œæ™‚æœƒè‡ªå‹•æç¤ºè¼¸å…¥ç™½é¹¿ API Keyï¼Œä¸¦ä¿å­˜åˆ°æœ¬åœ°é…ç½®ï¼š

```bash
node dist/cli.js ask "é€™å€‹å°ˆæ¡ˆæ˜¯åšä»€éº¼çš„ï¼Ÿ"
```

æˆ–è€…è¨­ç½®ç’°å¢ƒè®Šé‡ï¼š

```bash
# Windows PowerShell
$env:BAILU_API_KEY="sk-ä½ çš„ç™½é¹¿Key"

# macOS / Linux
export BAILU_API_KEY="sk-ä½ çš„ç™½é¹¿Key"
```

### 4. åŸºæœ¬ä½¿ç”¨

```bash
# ğŸ”¥ æœ€ç°¡å–®ï¼šç›´æ¥é€²å…¥äº¤äº’æ¨¡å¼ï¼ˆæ¨è–¦ï¼‰
node dist/cli.js
# æˆ–ç°¡å¯«ï¼šbailu

# é€²å…¥å¾Œå¯ä»¥ç›´æ¥å°è©±ï¼š
> é€™å€‹å°ˆæ¡ˆçš„ä¸»è¦å…¥å£æ–‡ä»¶æ˜¯ä»€éº¼ï¼Ÿ
> æŠŠ README çš„å®‰è£æ­¥é©Ÿæ”¹æˆ pnpm
> åˆ—å‡º src ç›®éŒ„çš„æ–‡ä»¶
> exit

# ä¹Ÿå¯ä»¥å¿«é€ŸåŸ·è¡Œå–®æ¬¡å‘½ä»¤ï¼ˆä¸é€²å…¥äº¤äº’ï¼‰
node dist/cli.js ask "é€™å€‹å°ˆæ¡ˆçš„ä¸»è¦å…¥å£æ–‡ä»¶æ˜¯ä»€éº¼ï¼Ÿ"
node dist/cli.js fix "æŠŠ README çš„å®‰è£æ­¥é©Ÿæ”¹æˆ pnpm"

# åŸ·è¡Œè¤‡é›œä»»å‹™
node dist/cli.js run "é‡æ§‹ auth æ¨¡çµ„ï¼Œåˆ†é›¢é©—è­‰é‚è¼¯"

# åˆ—å‡ºæ­·å²æœƒè©±
node dist/cli.js run --list

# æ¢å¾©ä¸­æ–·çš„ä»»å‹™
node dist/cli.js run --resume session_xxx
```

---

## ğŸ“š å‘½ä»¤è©³è§£

### `bailu`ï¼ˆç„¡åƒæ•¸ï¼‰
**ç›´æ¥é€²å…¥äº¤äº’æ¨¡å¼**ï¼Œé€™æ˜¯æœ€æ¨è–¦çš„ä½¿ç”¨æ–¹å¼ï¼

```bash
bailu
```

é€²å…¥å¾Œä½ å¯ä»¥ï¼š
- ğŸ’¬ å¤šè¼ªå°è©±ï¼ŒAI æœƒè¨˜ä½ä¸Šä¸‹æ–‡
- ğŸ”§ è®“ AI è®€å–ã€ä¿®æ”¹æ–‡ä»¶
- ğŸš€ åŸ·è¡Œå‘½ä»¤
- ğŸ“Š æŸ¥çœ‹å¯¦æ™‚åŸ·è¡Œéç¨‹

**ç‰¹æ®Šå‘½ä»¤ï¼š**
- `clear` - æ¸…ç©ºå°è©±æ­·å²
- `exit` æˆ– `quit` - é€€å‡º

---

### `bailu ask [å•é¡Œ]`
ç´”å•ç­”æ¨¡å¼ï¼Œä¸æœƒä¿®æ”¹ä»»ä½•æ–‡ä»¶ã€‚é©åˆï¼š
- äº†è§£ä»£ç¢¼åº«çµæ§‹
- è©¢å•æŠ€è¡“å¯¦ç¾
- ç²å–é–‹ç™¼å»ºè­°

**ç¤ºä¾‹ï¼š**
```bash
bailu ask "é€™å€‹å°ˆæ¡ˆç”¨äº†å“ªäº›ä¾è³´ï¼Ÿ"
bailu ask "auth æ¨¡çµ„çš„å·¥ä½œåŸç†æ˜¯ä»€éº¼ï¼Ÿ"
```

### `bailu fix [éœ€æ±‚æè¿°]`
AI è‡ªå‹•ä¿®æ”¹ä»£ç¢¼ï¼Œæ”¯æŒå·¥å…·èª¿ç”¨ã€‚æœƒï¼š
1. åˆ†æç•¶å‰ä»£ç¢¼åº«
2. è¦åŠƒä¿®æ”¹æ­¥é©Ÿ
3. èª¿ç”¨å·¥å…·ï¼ˆè®€æ–‡ä»¶ã€å¯«æ–‡ä»¶ã€è·‘å‘½ä»¤ï¼‰
4. åœ¨ review æ¨¡å¼ä¸‹å±•ç¤º diff ä¸¦è«‹æ±‚ç¢ºèª

**ç¤ºä¾‹ï¼š**
```bash
bailu fix "å„ªåŒ– package.json çš„è…³æœ¬ï¼ŒåŠ ä¸Š lint å‘½ä»¤"
bailu fix "æŠŠæ‰€æœ‰ var æ”¹æˆ const æˆ– let"
```

**å®‰å…¨æ§åˆ¶ï¼š**
```bash
# dry-runï¼šåªçœ‹è¨ˆç•«ï¼Œä¸åŸ·è¡Œ
BAILU_MODE=dry-run bailu fix "åˆªé™¤æ‰€æœ‰ console.log"

# reviewï¼šæ¯å€‹æ“ä½œå‰ç¢ºèªï¼ˆé»˜èªï¼‰
BAILU_MODE=review bailu fix "é‡æ§‹ä»£ç¢¼"

# auto-applyï¼šè‡ªå‹•åŸ·è¡Œï¼ˆå±éšªï¼‰
BAILU_MODE=auto-apply bailu fix "æ ¼å¼åŒ–ä»£ç¢¼"
```

### `bailu chat`
é€²å…¥äº¤äº’å¼å°è©±ï¼Œå¯ä»¥ï¼š
- å¤šè¼ªå°è©±è¨˜æ†¶ä¸Šä¸‹æ–‡
- éš¨æ™‚èª¿ç”¨å·¥å…·
- è¼¸å…¥ `clear` æ¸…ç©ºæ­·å²
- è¼¸å…¥ `exit` é€€å‡º

**ç¤ºä¾‹ï¼š**
```
ä½ : åˆ—å‡º src ç›®éŒ„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶
Bailu: (èª¿ç”¨ list_directory å·¥å…·)

ä½ : è®€å– src/index.ts
Bailu: (èª¿ç”¨ read_file å·¥å…·)

ä½ : å¹«æˆ‘åŠ å€‹æ—¥èªŒè¼¸å‡º
Bailu: (èª¿ç”¨ write_file å·¥å…·ï¼Œå±•ç¤º diffï¼Œè«‹æ±‚ç¢ºèª)
```

### `bailu run [ä»»å‹™æè¿°]`
åŸ·è¡Œè¤‡é›œçš„å¤šæ­¥é©Ÿä»»å‹™ï¼š
- è‡ªå‹•ä¿å­˜é€²åº¦
- æ”¯æŒä¸­æ–·å¾Œæ¢å¾©
- å®Œæ•´çš„åŸ·è¡Œæ­·å²

**ç¤ºä¾‹ï¼š**
```bash
# å‰µå»ºæ–°ä»»å‹™
bailu run "å¯¦ç¾ç”¨æˆ¶è¨»å†ŠåŠŸèƒ½ï¼šé©—è­‰éƒµç®±ã€å“ˆå¸Œå¯†ç¢¼ã€å¯«å…¥è³‡æ–™åº«"

# ä»»å‹™æœƒè‡ªå‹•ä¿å­˜ï¼Œè¼¸å‡ºé¡ä¼¼ï¼š
# [å‰µå»ºæ–°ä»»å‹™] ID: session_1234567_abc

# å¦‚æœä¸­æ–·ï¼ˆCtrl+Cï¼‰ï¼Œç¨å¾Œå¯ä»¥æ¢å¾©ï¼š
bailu run --resume session_1234567_abc

# æŸ¥çœ‹æ‰€æœ‰æ­·å²ä»»å‹™
bailu run --list
```

### `bailu models`
åˆ—å‡ºç•¶å‰ç™½é¹¿è³¬è™Ÿå¯ç”¨çš„æ¨¡å‹ï¼š

```bash
bailu models
```

---

## âš™ï¸ ç’°å¢ƒè®Šé‡

| è®Šé‡ | èªªæ˜ | é»˜èªå€¼ |
|------|------|--------|
| `BAILU_API_KEY` | ç™½é¹¿ API Key | ç„¡ï¼ˆé¦–æ¬¡æœƒæç¤ºè¼¸å…¥ï¼‰ |
| `BAILU_MODEL` | æ¨¡å‹ ID | `bailu-chat` |
| `BAILU_BASE_URL` | API ç«¯é» | `https://bailucode.com/openapi/v1` |
| `BAILU_MODE` | å®‰å…¨æ¨¡å¼ | `review` |
| `BAILU_CONFIG_DIR` | é…ç½®ç›®éŒ„ | `~/.config/bailu-cli` (Unix) / `%APPDATA%\bailu-cli` (Windows) |

---

## ğŸ—‚ï¸ é …ç›®é…ç½®

### `.bailu.yml`
åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„å‰µå»ºæ­¤æ–‡ä»¶ï¼Œå‘Šè¨´ AI å¦‚ä½•è™•ç†ä½ çš„å°ˆæ¡ˆï¼š

```yaml
# æ¸¬è©¦å‘½ä»¤
testCommand: "npm test"

# æ§‹å»ºå‘½ä»¤
buildCommand: "npm run build"

# AI æ‡‰è©²é—œæ³¨çš„ç›®éŒ„
includePaths:
  - "src"
  - "lib"

# AI æ‡‰è©²å¿½ç•¥çš„ç›®éŒ„
excludePaths:
  - "dist"
  - "node_modules"
  - ".git"

# é¡å¤–èªªæ˜
notes: |
  é€™æ˜¯ä¸€å€‹ TypeScript å°ˆæ¡ˆï¼Œä½¿ç”¨ ESM æ¨¡çµ„ç³»çµ±ã€‚
  ä¿®æ”¹ä»£ç¢¼å¾Œè«‹ç¢ºä¿é€šé TypeScript ç·¨è­¯æª¢æŸ¥ã€‚
```

### `AGENT.md`
æ›´è©³ç´°çš„ AI æŒ‡å¼•æ–‡ä»¶ï¼Œé¡ä¼¼ README ä½†æ˜¯å¯«çµ¦ AI çœ‹ï¼š

```markdown
# Bailu Agent æŒ‡å¼•

## å°ˆæ¡ˆæ¶æ§‹
- src/cli.ts - CLI å…¥å£
- src/agent/ - Agent æ ¸å¿ƒé‚è¼¯
- src/tools/ - å·¥å…·ç³»çµ±
- src/llm/ - LLM å®¢æˆ¶ç«¯

## é–‹ç™¼è¦ç¯„
- æ‰€æœ‰ TypeScript å¿…é ˆæœ‰é¡å‹æ¨™è¨»
- ä½¿ç”¨ 2 ç©ºæ ¼ç¸®æ’
- è¨»é‡‹ä½¿ç”¨ä¸­æ–‡

## æ¸¬è©¦
é‹è¡Œæ¸¬è©¦ï¼š`npm test`
æ¸¬è©¦æ¡†æ¶ï¼šJest

## ç™¼å¸ƒæµç¨‹
1. æ›´æ–° package.json ç‰ˆæœ¬è™Ÿ
2. npm run build
3. npm publish
```

---

## ğŸ”§ å¸¸è¦‹å•é¡Œ

### Q: ç‚ºä»€éº¼ç¬¬ä¸€æ¬¡é‹è¡Œå¾ˆæ…¢ï¼Ÿ
A: é¦–æ¬¡é‹è¡Œæ™‚ Bailu æœƒæƒææ•´å€‹ä»£ç¢¼åº«æ§‹å»ºä¸Šä¸‹æ–‡ã€‚å¾ŒçºŒé‹è¡Œæœƒå¿«å¾ˆå¤šã€‚

### Q: å¦‚ä½•åœæ­¢ Agent çš„æ“ä½œï¼Ÿ
A: åœ¨ review æ¨¡å¼ä¸‹ï¼Œæ¯å€‹æ“ä½œå‰éƒ½æœƒè©¢å•ã€‚ç›´æ¥è¼¸å…¥ `n` æ‹’çµ•ï¼Œæˆ– `q` é€€å‡ºæ•´å€‹ä»»å‹™ã€‚

### Q: AI æ”¹å£äº†æˆ‘çš„ä»£ç¢¼æ€éº¼è¾¦ï¼Ÿ
A: 
1. æ‰€æœ‰ `write_file` æ“ä½œé»˜èªæœƒå‰µå»º `.backup` å‚™ä»½æ–‡ä»¶
2. ä½¿ç”¨ Gitï¼š`git diff` æŸ¥çœ‹æ”¹å‹•ï¼Œ`git restore` å›æ»¾
3. åœ¨ review æ¨¡å¼ä¸‹ï¼Œæ¯æ¬¡æ”¹å‹•å‰éƒ½æœƒå±•ç¤º diff

### Q: æ¨¡å‹è¿”å› "Model bailu-chat does not exist"ï¼Ÿ
A: é‹è¡Œ `bailu models` æŸ¥çœ‹ä½ è³¬è™Ÿå¯ç”¨çš„æ¨¡å‹ï¼Œç„¶å¾Œè¨­ç½®ï¼š
```bash
export BAILU_MODEL="ä½ çš„æ¨¡å‹ID"
```

### Q: å¦‚ä½•æ¸…é™¤é…ç½®é‡æ–°é–‹å§‹ï¼Ÿ
A: åˆªé™¤é…ç½®æ–‡ä»¶ï¼š
- Windows: `%APPDATA%\bailu-cli\config.json`
- macOS/Linux: `~/.config/bailu-cli/config.json`

---

## ğŸ—ï¸ æ¶æ§‹æ¦‚è¦½

```
Bailu CLI
â”œâ”€â”€ CLI å±¤ï¼ˆcommanderï¼‰
â”‚   â”œâ”€â”€ ask / fix / chat / run
â”‚   â””â”€â”€ åƒæ•¸è§£æ + å•Ÿå‹• Logo
â”œâ”€â”€ Agent æ ¸å¿ƒ
â”‚   â”œâ”€â”€ BailuAgent - ä»»å‹™æ¨¡å‹èˆ‡ç‹€æ…‹æ©Ÿ
â”‚   â”œâ”€â”€ AgentOrchestrator - LLM â†” å·¥å…·å¾ªç’°
â”‚   â”œâ”€â”€ ChatSession - å¤šè¼ªå°è©±ç®¡ç†
â”‚   â””â”€â”€ SessionManager - æœƒè©±æŒä¹…åŒ–
â”œâ”€â”€ LLM å±¤
â”‚   â”œâ”€â”€ LLMClient - ç™½é¹¿ API èª¿ç”¨ï¼ˆæ”¯æŒæµå¼ï¼‰
â”‚   â””â”€â”€ Prompts - æç¤ºè©æ¨¡æ¿
â”œâ”€â”€ å·¥å…·ç³»çµ±
â”‚   â”œâ”€â”€ ToolRegistry - å·¥å…·è¨»å†Šä¸­å¿ƒ
â”‚   â”œâ”€â”€ ToolExecutor - å·¥å…·åŸ·è¡Œå™¨ï¼ˆå«å®‰å…¨ç­–ç•¥ï¼‰
â”‚   â”œâ”€â”€ ToolParser - è§£æ XML æ ¼å¼å·¥å…·èª¿ç”¨
â”‚   â””â”€â”€ å…§å»ºå·¥å…·ï¼šread_file / write_file / list_directory / run_command / apply_diff
â”œâ”€â”€ æ–‡ä»¶èˆ‡ Git
â”‚   â”œâ”€â”€ Workspace - æ–‡ä»¶è®€å¯«
â”‚   â”œâ”€â”€ Diff - unified diff ç”Ÿæˆï¼ˆå½©è‰²è¼¸å‡ºï¼‰
â”‚   â””â”€â”€ GitIntegration - Git ç‹€æ…‹æŸ¥è©¢
â””â”€â”€ å®‰å…¨èˆ‡åŸ·è¡Œ
    â”œâ”€â”€ SafetyPolicy - ä¸‰ç¨®æ¨¡å¼ + å‘½ä»¤ç™½é»‘åå–®
    â””â”€â”€ CommandRunner - å®‰å…¨çš„å­é€²ç¨‹åŸ·è¡Œ
```

---

## ğŸ¤ è²¢ç»

æ­¡è¿æäº¤ Issue å’Œ PRï¼

### æœ¬åœ°é–‹ç™¼

```bash
# å®‰è£ä¾è³´
npm install

# é–‹ç™¼æ¨¡å¼ï¼ˆä¸éœ€è¦ buildï¼‰
npm run dev ask "æ¸¬è©¦å•é¡Œ"

# æ§‹å»º
npm run build

# é‹è¡Œæ§‹å»ºå¾Œçš„ç‰ˆæœ¬
npm start ask "æ¸¬è©¦å•é¡Œ"
```

---

## ğŸ“œ è¨±å¯è­‰

MIT License

---

## ğŸ™ è‡´è¬

- [OpenAI Codex](https://github.com/openai/codex) - éˆæ„Ÿä¾†æº
- [ç™½é¹¿ AI](https://bailucode.com) - LLM æä¾›å•†
- [Commander.js](https://github.com/tj/commander.js) - CLI æ¡†æ¶
- [diff](https://github.com/kpdecker/jsdiff) - Diff ç®—æ³•

---

**è®“ AI æˆç‚ºä½ çš„çµ‚ç«¯å¤¥ä¼´ï¼Œå¾æ­¤ä»£ç¢¼è‡ªå·±æœƒæ”¹ä»£ç¢¼ã€‚** ğŸš€
